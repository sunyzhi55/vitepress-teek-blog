<template>
  <div class="my-links-container">
    <!-- é¡µé¢ä¸»æ ‡é¢˜åŒºåŸŸ -->
    <div class="my-links-title">
      <h1>{{ title }}</h1>
    </div>
    <!-- é¡¶éƒ¨BanneråŒºåŸŸ -->
    <div v-if="bannerShow" class="flink-banner" id="banners">
      <!-- å·¦ä¸Šè§’smallTitle -->
      <div class="banners-small-title">
        <svg t="1761472824402" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
          p-id="6414" width="24" height="24">
          <path
            d="M704 128C833.621333 128 938.666667 234.666667 938.666667 384c0 298.666667-320 469.333333-426.666667 533.333333-84.394667-50.602667-302.250667-167.978667-389.589333-362.666666h200.405333l39.850667-66.389334 128 213.333334L578.816 554.666667H725.333333v-85.333334h-194.816l-39.850666 66.389334-128-213.333334L274.517333 469.333333H94.293333A407.552 407.552 0 0 1 85.333333 384c0-149.333333 106.666667-256 234.666667-256C399.36 128 469.333333 170.666667 512 213.333333c42.666667-42.666667 112.64-85.333333 192-85.333333z"
            fill="currentColor" p-id="6415"></path>
        </svg>
        {{ smallTitle }}
      </div>

      <!-- å³ä¸Šè§’åŠŸèƒ½æŒ‰é’®ç»„ -->
      <div v-if="bannerButtonGroupShow" class="banner-button-group">
        <!-- éšæœºè®¿é—®æŒ‰é’® -->
        <button class="banner-button secondary" @click="handleRandomVisit" :disabled="allLinks.length === 0"
          aria-label="éšæœºè®¿é—®å‹é“¾">
          <svg t="1761473089094" class="icon" viewBox="0 0 1026 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
            p-id="8278" width="18" height="18">
            <path
              d="M1024 153.6c7.314286-29.257143 0-51.2-14.628571-65.828571-14.628571-14.628571-29.257143-14.628571-51.2-7.314286L51.2 431.542857c-21.942857 7.314286-36.571429 14.628571-43.885714 21.942857s-7.314286 21.942857-7.314286 29.257143 14.628571 14.628571 36.571429 21.942857l234.057142 73.142857 541.257143-336.457142c14.628571-7.314286 29.257143-14.628571 36.571429-7.314286 7.314286 0 0 7.314286-7.314286 14.628571l-438.857143 394.971429-14.628571 234.057143c14.628571 0 29.257143-7.314286 43.885714-21.942857l117.028572-109.714286 234.057142 175.542857c43.885714 21.942857 73.142857 14.628571 87.771429-36.571429l153.6-731.428571z"
              fill="currentColor" p-id="8279"></path>
          </svg>
          <span class="banner-button-text">éšæœºè®¿é—®</span>
        </button>

        <!-- ç”³è¯·å‹é“¾æŒ‰é’® -->
        <a class="banner-button primary" href="#post-comment" :disabled="!shouldShow" aria-label="ç”³è¯·å‹é“¾"
          @click="handleApplyFriendLink">
          <svg t="1761473156222" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
            p-id="10543" width="18" height="18">
            <path
              d="M535.630769 821.169231l-41.353846-5.907693s-27.569231-5.907692-41.353846-11.815384c-7.876923-1.969231-17.723077 0-23.630769 5.907692l-9.846154 9.846154c-57.107692 57.107692-149.661538 63.015385-208.738462 11.815385-66.953846-57.107692-68.923077-159.507692-7.876923-220.553847l149.661539-149.661538c19.692308-19.692308 43.323077-31.507692 66.953846-39.384615 31.507692-7.876923 64.984615-5.907692 94.523077 5.907692 17.723077 7.876923 35.446154 17.723077 51.2 33.476923 7.876923 7.876923 13.784615 15.753846 19.692307 25.6 7.876923 13.784615 25.6 15.753846 35.446154 3.938462l55.138462-55.138462c7.876923-7.876923 7.876923-19.692308 1.969231-29.538462-7.876923-11.815385-17.723077-21.661538-27.569231-31.507692-13.784615-13.784615-29.538462-27.569231-47.261539-37.415384-27.569231-17.723077-59.076923-29.538462-92.553846-35.446154-61.046154-11.815385-128-1.969231-183.138461 27.56923-21.661538 11.815385-43.323077 27.569231-61.046154 45.292308l-143.753846 143.753846C17.723077 622.276923 9.846154 791.630769 110.276923 897.969231c104.369231 114.215385 281.6 116.184615 389.907692 7.876923l49.23077-49.230769c13.784615-9.846154 3.938462-33.476923-13.784616-35.446154zM897.969231 114.215385c-108.307692-100.430769-277.661538-92.553846-380.061539 11.815384L472.615385 169.353846c-13.784615 13.784615-3.938462 37.415385 13.784615 39.384616 27.569231 1.969231 55.138462 7.876923 82.707692 15.753846 7.876923 1.969231 17.723077 0 23.63077-5.907693l9.846153-9.846153c57.107692-57.107692 149.661538-63.015385 208.738462-11.815385 66.953846 57.107692 68.923077 159.507692 7.876923 220.553846L669.538462 567.138462c-19.692308 19.692308-43.323077 31.507692-66.953847 39.384615-31.507692 7.876923-64.984615 5.907692-94.523077-5.907692-17.723077-7.876923-35.446154-17.723077-51.2-33.476923-7.876923-7.876923-13.784615-15.753846-19.692307-25.6-7.876923-13.784615-25.6-15.753846-35.446154-3.938462l-55.138462 55.138462c-7.876923 7.876923-7.876923 19.692308-1.96923 29.538461 7.876923 11.815385 17.723077 21.661538 27.56923 31.507692 13.784615 13.784615 31.507692 27.569231 47.261539 37.415385 27.569231 17.723077 59.076923 29.538462 90.584615 35.446154 61.046154 11.815385 128 1.969231 183.138462-27.569231 21.661538-11.815385 43.323077-27.569231 61.046154-45.292308l149.661538-149.661538c110.276923-108.307692 106.338462-285.538462-5.907692-389.907692z"
              fill="currentColor" p-id="10544"></path>
          </svg>
          <span class="banner-button-text">ç”³è¯·å‹é“¾</span>
        </a>
      </div>

      <!-- ä¸¤è¡Œå¤´åƒæ¨ªå‘æ— é™æ»šåŠ¨åŒºåŸŸï¼ˆé”™ä½æ’åˆ—ï¼‰ - ç™½æœ¨æ–°å¢æ ·å¼ -->
      <div class="tags-group-all">
        <!-- æ˜Ÿçˆ†æ•ˆæœå®¹å™¨ - ç™½æœ¨æ–°å¢æ ·å¼ -->
        <div class="global-stars" ref="starsContainer">
          <svg v-for="(style, index) in starStyles" :key="index" class="star-item" :class="`gstar-${index + 1}`"
            :style="style" viewBox="0 0 24 24">
            <path
              d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z" />
          </svg>
        </div>
        <div class="tags-group-wrapper">
          <!-- ç¬¬ä¸€è¡Œ -->
          <div class="tags-group-row" :class="{ 'offset-start': index % 2 === 0 }" v-for="(row, index) in avatarRows"
            :key="index">
            <div class="tags-group-content">
              <!-- ç™½æœ¨æ–°å¢æ ·å¼ -->
              <a v-for="(link, linkIndex) in row" :key="linkIndex" class="tags-group-icon" target="_blank"
                :href="link.link" :title="link.name" rel="external nofollow noopener"
                @mouseenter="handleAvatarMouseEnter($event, link)" @mouseleave="handleAvatarMouseLeave">
                <img :src="link.avatar" :alt="link.name" loading="lazy" :class="{ irregular: link.irregular }">
                <!-- æ¯›ç»ç’ƒåŠé€æ˜èƒŒæ™¯ - ç™½æœ¨æ–°å¢æ ·å¼ -->
                <div v-if="activeLink && activeLink.link === link.link" class="avatar-overlay">
                  <span class="avatar-text">{{ activeLink.name }}</span>
                </div>
              </a>
            </div>
          </div>
        </div>

      </div>
    </div>
    <!-- å‹é“¾åˆ†ç»„åˆ—è¡¨ï¼Œæ¯ä¸ªåˆ†ç»„åŒ…å«æ ‡é¢˜ã€æè¿°å’Œå‹é“¾åˆ—è¡¨ -->
    <div v-for="(group, index) in linksData" :key="index" class="my-links-group">
      <!-- åˆ†ç»„æ ‡é¢˜å®¹å™¨ -->
      <div class="title-wrapper">
        <h3>{{ group.title }}</h3>
      </div>

      <!-- åˆ†ç»„æè¿°æ–‡æœ¬ -->
      <p class="group-desc">{{ group.desc }}</p>

      <!-- å‹é“¾åˆ—è¡¨å®¹å™¨ -->
      <div class="links-grid">
        <!-- æ¯ä¸ªå‹é“¾é¡¹ä½¿ç”¨LinkItemå­ç»„ä»¶å±•ç¤ºï¼Œé€šè¿‡:dataä¼ é€’å‹é“¾ä¿¡æ¯ -->
        <div v-for="link in group.list" :key="link.link" class="links-grid__item">
          <LinkItem :data="link" />
        </div>
      </div>
    </div>

    <!-- ç•™è¨€/è¯„è®ºåŒºåŸŸï¼Œé»˜è®¤æ˜¾ç¤ºï¼Œå¯é€šè¿‡frontmatteréšè— -->
    <div v-if="commentShow" class="my-message-section" id="post-comment">
      <div class="title-wrapper">
        <h3>ç”³è¯·å‹é“¾</h3>
      </div>
      <p>æƒ³è¦å’Œæˆ‘äº¤æ¢å‹é“¾ï¼Ÿè¯·åœ¨è¯„è®ºåŒºæŒ‰ä»¥ä¸‹æ ¼å¼ç•™è¨€ ğŸ’</p>

      <!-- ç•™è¨€å¡ç‰‡å®¹å™¨ -->
      <div class="message-card">
        <!-- å¤åˆ¶æŒ‰é’®åŒºåŸŸ -->
        <div class="copy-button-container">
          <!-- å‹é“¾æ ¼æ ¼å¼ç¤ºä¾‹ -->
          <div class="Friendship-link-format">å‹é“¾æ ¼å¼ï¼š</div>
          <button class="copy-button" @click="copyMessageFormat" :aria-label="copyButtonText">
            <svg t="1761473315965" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
              p-id="12400" width="16" height="16">
              <path
                d="M480 0h248.2C753.6 0 778 10.2 796 28.2L931.8 164c18 18 28.2 42.4 28.2 67.8V672c0 53-43 96-96 96H480c-53 0-96-43-96-96V96c0-53 43-96 96-96zM160 256h160v128H192v512h384v-64h128v96c0 53-43 96-96 96H160c-53 0-96-43-96-96V352c0-53 43-96 96-96z"
                fill="currentColor" p-id="12401"></path>
            </svg>
            <span class="copy-button-text">{{ copyButtonText }}</span>
          </button>
        </div>
        <pre ref="messageFormat">
ç½‘ç«™åç§°: Hyde Blog
ç½‘ç«™é“¾æ¥: https://teek.seasir.top/
ç½‘ç«™å¤´åƒ: https://teek.seasir.top/avatar/avatar.webp
ç½‘ç«™æè¿°: äººå¿ƒä¸­çš„æˆè§æ˜¯ä¸€åº§å¤§å±±~</pre>
        <!-- è¯„è®ºåŒºæ’æ§½ -->
        <!-- é»˜è®¤ä¸ºTwikooè¯„è®ºç»„ä»¶ï¼Œå¯é€šè¿‡æ’æ§½è‡ªå®šä¹‰å…¶ä»–è¯„è®ºç³»ç»Ÿ -->
        <slot name="comments">
          <Twikoo />
        </slot>
      </div>
    </div>

    <!-- æ»šåŠ¨åˆ°è¯„è®ºåŒºæŒ‰é’® -->
    <ScrollToComment v-if="shouldShow" :show="showScrollButton" :scroll-to-comment="scrollToComment" />
  </div>
</template>

<script setup>
import { useData } from "vitepress";
import LinkItem from "./LinkItem.vue";
// å¯¼å…¥Twikooè¯„è®ºç»„ä»¶
import Twikoo from "../Twikoo/Twikoo.vue";
import { computed, ref, onMounted, onUnmounted } from "vue";
// å¼•å…¥é¡¶éƒ¨åŒºåŸŸå¤´åƒæ˜Ÿçˆ†æ•ˆæœ+æ¯›ç»ç’ƒèƒŒæ™¯åŠŸèƒ½  - ç™½æœ¨æ–°å¢æ ·å¼
import { useStarBurst } from "./DiySlinkShiroki.ts";
// å¯¼å…¥æ¶ˆæ¯æç¤ºç»„ä»¶
import { TkMessage } from "vitepress-theme-teek";
import ScrollToComment from "../ScrollToComment.vue";

/**
 * å•ä¸ªå‹é“¾çš„æ•°æ®ç»“æ„å®šä¹‰
 * @typedef {Object} Link
 * @property {string} name - å‹é“¾ç½‘ç«™åç§°
 * @property {string} link - å‹é“¾ç½‘ç«™URLåœ°å€
 * @property {string} avatar - å‹é“¾ç½‘ç«™å¤´åƒ/Logoçš„å›¾ç‰‡URL
 * @property {string} descr - å‹é“¾ç½‘ç«™çš„ç®€çŸ­æè¿°
 * @property {boolean} [irregular] - å¯é€‰å‚æ•°ï¼Œé»˜è®¤å€¼ä¸ºfalseï¼Œä¸ºfalseæ—¶å°†æŠŠå¤´åƒå¤„ç†ä¸ºåœ†å½¢
 */

/**
 * å‹é“¾åˆ†ç»„çš„æ•°æ®ç»“æ„å®šä¹‰
 * @typedef {Object} LinkGroup
 * @property {string} title - åˆ†ç»„æ ‡é¢˜
 * @property {string} desc - åˆ†ç»„æè¿°æ–‡å­—
 * @property {Link[]} list - è¯¥åˆ†ç»„ä¸‹çš„å‹é“¾åˆ—è¡¨æ•°ç»„
 */

// ä»é¡µé¢frontmatterä¸­è·å–é…ç½®æ•°æ®
const { frontmatter } = useData();

// ä»frontmatterä¸­è¯»å–linkså­—æ®µï¼Œå¦‚æœæœªå®šä¹‰åˆ™ä½¿ç”¨ç©ºæ•°ç»„
const linksData = computed(() => frontmatter.value.links || []);

// ä»frontmatterä¸­è¯»å–titleå­—æ®µï¼Œé»˜è®¤å€¼ä¸º"æˆ‘çš„å‹é“¾"
const title = computed(() => frontmatter.value.title || "æˆ‘çš„å‹é“¾");

// å½“frontmatterä¸­commentsä¸ºfalseæ—¶éšè—ï¼Œé»˜è®¤æ˜¾ç¤º
const commentShow = computed(() => frontmatter.value.comments !== false);
// å½“frontmatterä¸­bannerä¸ºfalseæ—¶éšè—ï¼Œé»˜è®¤æ˜¾ç¤º
const bannerShow = computed(() => frontmatter.value.banner !== false);
// å½“frontmatterä¸­bannerButtonGroupä¸ºfalseæ—¶éšè—ï¼Œé»˜è®¤æ˜¾ç¤º
const bannerButtonGroupShow = computed(() => frontmatter.value.bannerButtonGroup !== false);
// å¯è‡ªå®šä¹‰frontmatterä¸­çš„smallTitleï¼Œä½œä¸ºbannerçš„å°æ ‡é¢˜ï¼Œé»˜è®¤å€¼ä¸º"ä¸å„ä½åšä¸»ä¸€èµ·æˆé•¿è¿›æ­¥"
const smallTitle = computed(() => frontmatter.value.smallTitle || "ä¸å„ä½åšä¸»ä¸€èµ·æˆé•¿è¿›æ­¥");

const allLinks = computed(() => {
  return linksData.value.reduce((acc, group) => {
    const processedLinks = group.list.map(link => ({
      ...link,
      avatar: link.avatar
    }));
    acc.push(...processedLinks);
    return acc;
  }, []);
});

// å°†å¤´åƒå¹³å‡åˆ†æˆä¸¤è¡Œï¼Œå¹¶å¤åˆ¶å†…å®¹ä»¥å®ç°æ— ç¼æ»šåŠ¨
const avatarRows = computed(() => {
  const avatars = allLinks.value;
  if (avatars.length === 0) return [[], []];

  const mid = Math.ceil(avatars.length / 2);
  const row1 = avatars.slice(0, mid);
  const row2 = avatars.slice(mid);

  // å¤åˆ¶å†…å®¹ä»¥å®ç°æ— ç¼æ»šåŠ¨
  return [
    [...row1, ...row1], // ç¬¬ä¸€è¡Œå¤åˆ¶ä¸€ä»½
    [...row2, ...row2]  // ç¬¬äºŒè¡Œå¤åˆ¶ä¸€ä»½
  ];
});

const handleRandomVisit = () => {
  if (allLinks.value.length === 0) return;
  const randomIndex = Math.floor(Math.random() * allLinks.value.length);
  const randomLink = allLinks.value[randomIndex];
  window.open(randomLink.link, "_blank");
};

// å¤„ç†ç”³è¯·å‹é“¾æŒ‰é’®ç‚¹å‡»äº‹ä»¶
const handleApplyFriendLink = (event) => {
  // é˜»æ­¢é»˜è®¤çš„é”šç‚¹è·³è½¬è¡Œä¸º
  event.preventDefault();

  const commentElement = document.querySelector(
    "#post-comment"
  );

  if (commentElement) {
    commentElement.scrollIntoView({
      behavior: "smooth",
      block: "start",
    });

    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯æç¤º
    TkMessage({
      message: "å·²è·³è½¬åˆ°ç•™é“¾åŒºï¼Œæ¬¢è¿ç•™ä¸‹æ‚¨çš„å‹é“¾ä¿¡æ¯âœ¨",
      type: "success",
    });
  } else {
    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯„è®ºåŒºåŸŸï¼Œæ˜¾ç¤ºæç¤º
    TkMessage({
      message: "æœªæ‰¾åˆ°ç•™é“¾åŒº",
      type: "warning",
    });
  }
};

// æ§åˆ¶æ»šåŠ¨åˆ°è¯„è®ºåŒºæŒ‰é’®çš„æ˜¾ç¤ºé€»è¾‘
const shouldShow = computed(() => commentShow.value);
const showScrollButton = ref(true);

// æ»šåŠ¨åˆ°è¯„è®ºåŒºå‡½æ•°
const scrollToComment = () => {
  const commentElement = document.querySelector(
    "#twikoo, .my-message-section, .message-card"
  );
  if (commentElement) {
    commentElement.scrollIntoView({
      behavior: "smooth",
      block: "start",
    });

    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯æç¤º
    TkMessage({
      message: "å·²æŠµè¾¾è¯„è®ºåŒºâœ¨",
      type: "success",
    });
  } else {
    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯„è®ºåŒºåŸŸï¼Œæ˜¾ç¤ºæç¤º
    TkMessage({
      message: "æœªæ‰¾åˆ°ç•™é“¾åŒº",
      type: "warning",
    });
  }
};

// æ™ºèƒ½æ˜¾ç¤º/éšè—æ»šåŠ¨æŒ‰é’®é€»è¾‘
const isScrolledToComment = ref(false);

// èŠ‚æµå‡½æ•° - é™åˆ¶å‡½æ•°æ‰§è¡Œé¢‘ç‡
const throttle = (func, delay) => {
  let timeoutId;
  let lastExecTime = 0;

  return function (...args) {
    const currentTime = Date.now();

    if (currentTime - lastExecTime > delay) {
      func.apply(this, args);
      lastExecTime = currentTime;
    } else {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() => {
        func.apply(this, args);
        lastExecTime = Date.now();
      }, delay - (currentTime - lastExecTime));
    }
  };
};

// ç¼“å­˜DOMæŸ¥è¯¢ç»“æœ
let cachedCommentElement = null;

// ä¼˜åŒ–åçš„æ»šåŠ¨ä½ç½®æ£€æŸ¥å‡½æ•°
const checkScrollPosition = () => {
  if (!cachedCommentElement) {
    cachedCommentElement = document.querySelector(
      "#twikoo, .my-message-section, .message-card"
    );
  }

  if (cachedCommentElement) {
    // ä½¿ç”¨requestAnimationFrameé¿å…å¼ºåˆ¶é‡æ’
    requestAnimationFrame(() => {
      const rect = cachedCommentElement.getBoundingClientRect();
      // å¦‚æœè¯„è®ºåŒºå…ƒç´ åœ¨è§†å£é¡¶éƒ¨é™„è¿‘ï¼ˆè·ç¦»é¡¶éƒ¨å°äº200pxï¼‰ï¼Œåˆ™è®¤ä¸ºå·²ç»æ»šåŠ¨åˆ°è¯„è®ºåŒº
      isScrolledToComment.value = rect.top <= 200;

      // æ ¹æ®æ˜¯å¦æ»šåŠ¨åˆ°è¯„è®ºåŒºæ¥æ˜¾ç¤º/éšè—æŒ‰é’®
      showScrollButton.value = !isScrolledToComment.value;
    });
  }
};

// èŠ‚æµç‰ˆæœ¬çš„æ»šåŠ¨æ£€æŸ¥ï¼ˆæ¯100msæ‰§è¡Œä¸€æ¬¡ï¼‰
const throttledCheckScrollPosition = throttle(checkScrollPosition, 100);

// æ·»åŠ æ»šåŠ¨äº‹ä»¶ç›‘å¬
onMounted(() => {
  if (starsContainer.value) {
    setWrap(starsContainer.value);
  }

  // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ä¸€æ¬¡
  checkScrollPosition();

  // æ·»åŠ èŠ‚æµåçš„æ»šåŠ¨äº‹ä»¶ç›‘å¬
  window.addEventListener('scroll', throttledCheckScrollPosition, { passive: true });
});

// ç»„ä»¶å¸è½½æ—¶ç§»é™¤äº‹ä»¶ç›‘å¬
onUnmounted(() => {
  window.removeEventListener('scroll', throttledCheckScrollPosition);
  cachedCommentElement = null;
});

// æ˜Ÿçˆ†æ•ˆæœç›¸å…³ - ç™½æœ¨æ–°å¢æ ·å¼
const { gStarStyle, setWrap, onAvatarEnter, onAvatarLeave } = useStarBurst();
const starStyles = ref(gStarStyle);
const activeLink = ref(null);
const starsContainer = ref(null);

// å¤„ç†å¤´åƒé¼ æ ‡è¿›å…¥äº‹ä»¶ - ç™½æœ¨æ–°å¢æ ·å¼
const handleAvatarMouseEnter = (event, link) => {
  // è°ƒç”¨æ˜Ÿçˆ†æ•ˆæœå‡½æ•° - ç™½æœ¨æ–°å¢æ ·å¼
  onAvatarEnter(event);

  // è®¾ç½®å½“å‰æ¿€æ´»çš„é“¾æ¥ - ç™½æœ¨æ–°å¢æ ·å¼
  activeLink.value = link;
};

// å¤„ç†å¤´åƒé¼ æ ‡ç¦»å¼€äº‹ä»¶ - ç™½æœ¨æ–°å¢æ ·å¼
const handleAvatarMouseLeave = () => {
  // è°ƒç”¨æ˜Ÿçˆ†æ•ˆæœå‡½æ•° - ç™½æœ¨æ–°å¢æ ·å¼
  onAvatarLeave();

  // æ¸…é™¤æ¿€æ´»çš„é“¾æ¥ - ç™½æœ¨æ–°å¢æ ·å¼
  activeLink.value = null;
};

// ç»„ä»¶æŒ‚è½½åè®¾ç½®æ˜Ÿæ˜Ÿå®¹å™¨ - ç™½æœ¨æ–°å¢æ ·å¼
onMounted(() => {
  if (starsContainer.value) {
    setWrap(starsContainer.value);
  }
});

// å¤åˆ¶åŠŸèƒ½ç›¸å…³
const messageFormat = ref(null);
const copyButtonText = ref('å¤åˆ¶æ ¼å¼');
const copyMessageFormat = async () => {
  if (!messageFormat.value) return;
  const text = messageFormat.value.textContent;
  await navigator.clipboard.writeText(text);
  // å¤åˆ¶æˆåŠŸåé¦ˆ
  copyButtonText.value = 'å·²å¤åˆ¶ !';
  // 2ç§’åæ¢å¤åŸæ–‡æœ¬
  setTimeout(() => {
    copyButtonText.value = 'å¤åˆ¶æ ¼å¼';
  }, 2000);
};
</script>

<style scoped>
/* å¯¼å…¥è‡ªå®šä¹‰æ ·å¼ - åŒ…å«ç™½æœ¨æ–°å¢æ ·å¼ */
@import "./DiySlinkShiroki.scss";

/* ä¸»å®¹å™¨æ ·å¼ */
.my-links-container {
  max-width: 1500px;
  margin: 0 auto;
  padding: 40px 10px;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
}

/* æ ‡é¢˜åŒºåŸŸæ ·å¼ */
.my-links-title {
  margin-bottom: 50px;
  padding: 0 10px;
  text-align: center;
}

/* ä¸»æ ‡é¢˜æ ·å¼ */
.my-links-title h1 {
  font-size: 2rem;
  font-weight: 600;
  background: -webkit-linear-gradient(107deg,
      rgb(255, 182, 133) -30.6%,
      rgb(255, 111, 29) -1.11%,
      rgb(252, 181, 232) 39.14%,
      rgb(135, 148, 255) 73.35%,
      rgb(60, 112, 255) 97.07%,
      rgb(60, 112, 255) 118.97%);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  line-height: 1.2;
  display: inline-block;
  font-size: 2rem;
}

/* BanneråŒºåŸŸ */
.flink-banner {
  border: 1px solid var(--vp-c-divider);
  background-color: var(--vp-c-bg);
  border-radius: 12px;
  padding: 50px 20px 30px;
  margin-bottom: 60px;
  position: relative;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
}

/* å·¦ä¸Šè§’smallTitle */
.banners-small-title {
  position: absolute;
  top: 20px;
  left: 20px;
  font-size: 1.5rem;
  font-weight: 500;
  color: var(--vp-c-text-1);
  z-index: 2;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* å·¦ä¸Šè§’SVGå›¾æ ‡æ ·å¼ */
.banners-small-title svg {
  width: 24px;
  height: 24px;
  flex-shrink: 0;
  transition: transform 0.3s ease;
}

.banners-small-title:hover svg {
  transform: scale(1.1);
}

/* ç§»åŠ¨ç«¯æ°´å¹³å±…ä¸­ */
@media (max-width: 768px) {
  .banners-small-title {
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    width: auto;
    white-space: nowrap;
  }
}

/* å³ä¸Šè§’æŒ‰é’®ç»„ */
.banner-button-group {
  position: absolute;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 16px;
  z-index: 2;
}

.banner-button {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 8px 20px;
  border-radius: 8px;
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
  text-decoration: none;
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  letter-spacing: 0.5px;
}

.banner-button.secondary {
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.banner-button.primary {
  background: var(--vp-c-brand-1);
  color: white;
  border: 1px solid rgba(59, 130, 246, 0.3);
}

/* æŒ‰é’®å›¾æ ‡æ ·å¼ */
.banner-button i {
  font-size: 18px;
  transition: all 0.3s ease;
  position: relative;
  z-index: 1;
}

/* æŒ‰é’®æ–‡å­—æ ·å¼ */
.banner-button-text {
  position: relative;
  z-index: 1;
}

/* æŒ‰é’®æ‚¬åœæ•ˆæœ */
.banner-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.banner-button.secondary:hover {
  background: linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(248, 250, 252, 1));
  border-color: rgba(255, 255, 255, 0.4);
  color: #1f2937;
  /* ç¡®ä¿åœ¨æµ…è‰²èƒŒæ™¯ä¸Šæœ‰è¶³å¤Ÿçš„å¯¹æ¯”åº¦ */
}

.banner-button.primary:hover {
  background: var(--vp-c-brand-1);
  border-color: rgba(59, 130, 246, 0.5);
}

.banner-button:hover i {
  transform: translateY(-1px) scale(1.1);
}

/* æŒ‰é’®æ¿€æ´»çŠ¶æ€ */
.banner-button:active {
  transform: translateY(0);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

/* ç¦ç”¨çŠ¶æ€ */
.banner-button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none !important;
}

.banner-button:disabled:hover {
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

/* é—ªå…‰æ•ˆæœ */
.banner-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg,
      transparent,
      rgba(255, 255, 255, 0.4),
      transparent);
  transition: left 0.6s ease;
}

.banner-button:hover::before {
  left: 100%;
}

/* æŒ‰é’®å†…å‘å…‰æ•ˆæœ */
.banner-button::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border-radius: 12px;
  box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.1);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.banner-button:hover::after {
  opacity: 1;
}

/* ä¸¤è¡Œå¤´åƒæ¨ªå‘æ»šåŠ¨åŒºåŸŸ */
.tags-group-all {
  width: 100%;
  overflow: hidden;
  padding: 40px 0 10px;
  position: relative;
}

/* æ»šåŠ¨åŒ…è£…å™¨ */
.tags-group-wrapper {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* æ¯ä¸€è¡Œ */
.tags-group-row {
  display: flex;
  width: max-content;
  animation: scrollRow 60s linear infinite;
  will-change: transform;
  backface-visibility: hidden;
}

/* åŸæœ¬çš„æ‚¬åœæ—¶åœæ­¢æ»šåŠ¨åŠ¨ç”»æ ·å¼ï¼Œ
å·²ç§»è‡³DiySlinkShiroki.scss
- ç™½æœ¨æ–°å¢æ ·å¼
*/

/* å†…å®¹ç»„ */
.tags-group-content {
  display: flex;
  gap: 20px;
  padding: 0 10px;
}

/* ä¸Šä¸‹è¡Œé”™ä½æ’åˆ— */
.offset-start {
  margin-left: 60px;
  /* é”™å¼€åŠä¸ªå¤´åƒ */
}

/* æ»šåŠ¨åŠ¨ç”» */
@keyframes scrollRow {
  0% {
    transform: translateX(0);
  }

  100% {
    transform: translateX(-40%);
  }
}

/* å¤´åƒæ ·å¼æ ·å¼
å·²ç§»è‡³DiySlinkShiroki.scss
- ç™½æœ¨æ–°å¢æ ·å¼
*/

/* å¤´åƒè¦†ç›–å±‚æ ·å¼
å·²ç§»è‡³DiySlinkShiroki.scss
- ç™½æœ¨æ–°å¢æ ·å¼
*/

/* ç¡®ä¿å†…å®¹åœ¨bannerå†…éƒ¨ - ç™½æœ¨æ–°å¢æ ·å¼åï¼Œä¿®å¤ä¸€ä¸ªbug */
.tags-group-all {
  position: relative;
  overflow: hidden;
  width: 100%;
  box-sizing: border-box;
}

/* æ˜Ÿæ˜Ÿç›¸å…³æ ·å¼
  å·²ç§»è‡³DiySlinkShiroki.scss
  - ç™½æœ¨æ–°å¢æ ·å¼
  */

.my-links-group {
  margin-bottom: 40px;
}

/* åˆ†ç»„æ ‡é¢˜è£…é¥°çº¿æ ·å¼ */
.title-wrapper {
  position: relative;
  margin: 40px 0;
  height: 1px;
  background: #ddd;
  transition: 0.3s;
}

/* åˆ†ç»„æ ‡é¢˜æ–‡å­—æ ·å¼ */
.title-wrapper h3 {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  background: var(--vp-c-bg);
  padding: 0 20px;
  font-size: 1.3rem;
  font-weight: 600;
  color: var(--vp-c-text-1);
  z-index: 1;
}

/* åˆ†ç»„æè¿°æ–‡å­—æ ·å¼ */
.group-desc {
  text-align: center;
  color: var(--vp-c-text-2);
  font-size: 0.95rem;
  margin-bottom: 30px;
  padding: 0 10px;
}

/* å‹é“¾ç½‘æ ¼å¸ƒå±€ - æ ¸å¿ƒå“åº”å¼å®ç° */
.links-grid {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  /* è®©æ‰€æœ‰è¡Œçš„å†…å®¹å±…ä¸­å¯¹é½ */
  gap: 24px;
  margin-bottom: 60px;
  padding: 0 8px;
}

/* æ¯ä¸ªå‹é“¾é¡¹çš„æ ·å¼ï¼Œè®¾ç½®åŸºç¡€å®½åº¦ */
.links-grid__item {
  flex: 0 0 calc(100% - 24px);
  /* ç§»åŠ¨è®¾å¤‡ï¼šæ¯è¡Œ1ä¸ª */
  break-inside: avoid;
}

/* å¹³æ¿è®¾å¤‡ï¼šæ¯è¡Œ2ä¸ª */
@media (min-width: 768px) {
  .links-grid__item {
    flex: 0 0 calc(50% - 24px);
  }
}

/* æ¡Œé¢è®¾å¤‡ï¼šæ¯è¡Œæœ€å¤š4ä¸ª */
@media (min-width: 1024px) {
  .links-grid__item {
    flex: 0 0 calc(25% - 24px);
  }
}

/* ç•™è¨€åŒºæ ·å¼ */
.my-message-section {
  text-align: center;
  margin-top: 20px;
}

/* ç•™è¨€å¡ç‰‡æ ·å¼ */
.message-card {
  width: 100%;
  max-width: 1500px;
  margin: 30px auto;
  padding: 32px;
  border-radius: 12px;
  background: var(--vp-c-bg);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  border: 1px solid var(--vp-c-divider);
  text-align: left;
  position: relative;
}

/* å¤åˆ¶æŒ‰é’®å®¹å™¨ */
.copy-button-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  padding: 0 4px;
}

/* å‹é“¾æ ¼å¼æ–‡å­—æ ·å¼ */
.Friendship-link-format {
  font-size: 1rem;
  font-weight: 600;
  color: var(--vp-c-text-1);
  margin: 0;
  flex-shrink: 0;
}

/* å¤åˆ¶æŒ‰é’®æ ·å¼ */
.copy-button {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  border-radius: 8px;
  font-size: 0.9rem;
  font-weight: 500;
  transition: all 0.3s ease;
  background: var(--vp-c-bg-soft);
  color: var(--vp-c-text-1);
  text-decoration: none;
  border: none;
}

.copy-button:hover::before {
  left: 100%;
}

.copy-button:hover {
  background: var(--vp-c-brand-1);
  color: white;
  /* ç¡®ä¿åœ¨å“ç‰Œè‰²èƒŒæ™¯ä¸Šæ–‡å­—æ¸…æ™°å¯è§ */
}

/* ä¿®å¤é”™è¯¯çš„CSSé€‰æ‹©å™¨ */
.copy-button::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border-radius: 8px;
  box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.1);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.copy-button:hover::after {
  opacity: 1;
}

.copy-button:active {
  transform: translateY(0);
}

/* ç¤ºä¾‹æ ¼å¼ä»£ç å—æ ·å¼ */
.message-card pre {
  background: var(--vp-code-block-bg);
  padding: 16px;
  border-radius: 8px;
  font-size: 0.95rem;
  overflow-x: auto;
  margin: 20px 0;
  border: 1px solid var(--vp-c-divider);
  line-height: 1.5;
  position: relative;
}

/* ç§»åŠ¨ç«¯ç•™è¨€å¡ç‰‡é€‚é… */
@media (max-width: 768px) {
  .message-card {
    padding: 24px;
    margin: 24px auto;
  }

  .copy-button-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding: 0 4px;
    width: 100%;
  }

  /* ç§»åŠ¨ç«¯å‹é“¾æ ¼å¼æ–‡å­—æ ·å¼ */
  .Friendship-link-format {
    font-size: 0.95rem;
    font-weight: 600;
  }

  .copy-button {
    padding: 6px 12px;
    font-size: 0.85rem;
  }

  .tags-group-icon {
    flex: 0 0 80px;
    width: 80px;
    height: 80px;
  }

  .tags-group-content {
    gap: 15px;
  }

  .offset-start {
    margin-left: 40px;
    /* ç§»åŠ¨ç«¯é€‚é… */
  }

  .flink-banner {
    padding: 30px 15px 20px;
  }

  .banner-button {
    padding: 8px 16px;
    font-size: 0.85rem;
  }

  /* ç§»åŠ¨ç«¯éšè—æŒ‰é’® */
  .banner-button-group {
    display: none;
  }

  /* ç§»åŠ¨ç«¯æ»šåŠ¨é€Ÿåº¦è°ƒæ•´ */
  .tags-group-row {
    animation-duration: 40s;
  }
}

/* å‡å°‘åŠ¨ç”»å¯¹æ€§èƒ½çš„å½±å“ */
@media (prefers-reduced-motion: reduce) {
  .tags-group-row {
    animation: none;
  }
}
</style>