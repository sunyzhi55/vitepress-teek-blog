---
categories:
- Teek
coverImg: /home/bg2.webp
date: 2025-05-09 14:13:08
description: åŸºäºåœ¨ VitePress ä¸»é¢˜ä¸­å®ç°è¿”å›é¡¶éƒ¨æŒ‚ä»¶,åŸºäº Vue 3 ç»„åˆå¼ API å®ç°å¯è§†åŒ–æ»šåŠ¨è¿›åº¦æ¡ä¸å¹³æ»‘è¿”å›é¡¶éƒ¨åŠŸèƒ½ï¼ŒåŠ¨æ€è¿›åº¦è®¡ç®—ä¸è§†å£è”åŠ¨ï¼›RAFåŠ¨ç”»å¸§æ€§èƒ½ä¼˜åŒ–;å“åº”å¼è®¾è®¡é€‚é…å¤šç«¯;ç»„ä»¶åŒ–æ¶ˆæ¯åé¦ˆé›†æˆ;æµè§ˆå™¨å…¼å®¹æ€§å¤„ç†ï¼ˆSafariç‰¹åˆ«é€‚é…ï¼‰
permalink: /Teek/34bc87
title: è¿”å›é¡¶éƒ¨æŒ‚ä»¶
titleTag: åŸåˆ›
top: true
---
## æ–°å»ºç»„ä»¶

åœ¨`docs\.vitepress\theme\components`æ–‡ä»¶å¤¹ä¸‹æ–°å»º`CatBackToTop.vue`æ–‡ä»¶
::: tip æç¤º
[æŒ‚ä»¶æ ·å¼è·å–](https://img.seasir.top/2025/05/09/17/10/17/scroll_1746781817864.gif)
:::

```vue
// è¿”å›é¡¶éƒ¨æŒ‚ä»¶
<template>
  <div
    class="back_to_top"
    ref="toTop"
    :style="{
      top: top + 'px',
    }"
    @click="topTop"
  ></div>
</template>
<script setup lang="ts" name="BackToTop">
import { useRoute } from "vitepress";
import { nextTick, onUnmounted, ref, watch } from "vue";
import { TkMessage } from "vitepress-theme-teek";
import { onMounted } from "vue";

const route = useRoute();
const toTop = ref();
const top = ref<number>(-900);
const offsetHeight = ref<number>(0);

const topTop = () => {
  top.value = -900;
  window.scrollTo({
    top: 0,
    behavior: "smooth",
    // @ts-ignore Safariå…¼å®¹
    ...(typeof CSS !== "undefined" && CSS.supports("scroll-behavior", "smooth")
      ? {}
      : { left: 0 }),
  });
  TkMessage.success({
    message: "å·²è¾¾åˆ°é¡¶éƒ¨ğŸ‰",
    duration: 3000,
  });
};

let animationFrame: number | null = null;

const backToTop = () => {
  if (!animationFrame) {
    animationFrame = requestAnimationFrame(() => {
      const { documentElement } = document;
      // æ‰¹é‡è¯»å–
      const measurements = {
        offsetHeight: documentElement.offsetHeight,
        scrollTop: documentElement.scrollTop,
      };
      // æ‰¹é‡æ›´æ–°
      if (measurements.scrollTop < 100) {
        top.value = -900;
      } else {
        top.value =
          (900 - (measurements.scrollTop / measurements.offsetHeight) * 900) *
          -1;
      }
      animationFrame = null;
    });
  }
};

onUnmounted(() => {
  window.removeEventListener("scroll", backToTop);
});

onMounted(() => {
  // åˆå§‹åŒ–DOMç›¸å…³æ“ä½œ
  offsetHeight.value = document.documentElement.offsetHeight;

  // è·¯ç”±å˜åŒ–æ—¶æ›´æ–°é«˜åº¦
  watch(
    () => route.path,
    () => {
      nextTick(() => {
        offsetHeight.value = document.querySelector("html")!.offsetHeight;
      });
    },
    { immediate: true }
  );

  // æ·»åŠ æ»šåŠ¨äº‹ä»¶ç›‘å¬
  window.addEventListener("scroll", backToTop);
});
</script>
<style lang="scss" scoped>
@keyframes float {
  0% {
    -webkit-transform: translateY(0);
    -ms-transform: translateY(0);
    transform: translateY(0);
  }

  50% {
    -webkit-transform: translateY(-10px);
    -ms-transform: translateY(-10px);
    transform: translateY(-10px);
  }

  100% {
    -webkit-transform: translateY(0);
    -ms-transform: translateY(0);
    transform: translateY(0);
  }
}

.back_to_top {
  cursor: pointer;
  position: fixed;
  left: 25px;
  top: -900px;
  z-index: 1000;
  width: 70px;
  height: 900px;
  background: url("/backToTop/scroll.gif");
  transition: all 0.5s ease-in-out;
  opacity: 1;

  // æ–°å¢ç§»åŠ¨ç«¯éšè—
  @media (max-width: 768px) {
    background: none;
    pointer-events: none;
    width: 0;
    height: 0;
  }

  &:hover {
    animation: float 2s linear infinite;
  }
}
</style>
```

## æ³¨å†Œç»„ä»¶

åœ¨`docs\.vitepress\theme\components\TeekLayoutProvider.vue`ä¸­æ³¨å†Œ`CatBackToTop.vue`ç»„ä»¶

```vue {3,10-11}
<script setup lang="ts" name="TeekLayoutProvider">
// @ts-ignore
import CatBackToTop from "./CatBackToTop.vue"; //å¯¼å…¥è¿”å›é¡¶éƒ¨ç»„ä»¶  // [!code focus]
</script>

<template>
  <Teek.Layout>
    <template #layout-top>
      // [!code focus:2]
      <!--è¿”å›é¡¶éƒ¨ç»„ä»¶  -->
      <CatBackToTop />
    </template>
    å…¶ä»–ç»„ä»¶...
  </Teek.Layout>
</template>
```

## æ•ˆæœå±•ç¤º

![250509142904138.png](https://img.seasir.top/2025/05/09/14/29/04/250509142904138_1746772144187.png)

## å…¶ä»–æ‹“å±•

- é»˜è®¤ç§»åŠ¨ç«¯ä¸æ˜¾ç¤ºï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºï¼Œå¯æ³¨é‡Š`BackToTop.vue`ä¸­çš„ä»£ç 

```scss
@media (max-width: 768px) {
  background: none;
  pointer-events: none;
  width: 0;
  height: 0;
}
```

- æ§åˆ¶æŒ‚ä»¶å·¦å³è·ç¦»

```scss
.back_to_top {
  right: 40px;
}
```

- å¦‚æœéœ€è¦è¿”å›é¡¶éƒ¨æŒ‚ä»¶é«˜åº¦å’Œ body ä¸€è‡´ï¼Œå¯ä»¥ä¿®æ”¹`BackToTop.vue`ä¸­çš„ä»£ç ï¼Œåˆ—å¦‚`900`æ”¹ä¸º`100`

```ts {9}
const backToTop = () => {
  if (!animationFrame) {
    animationFrame = requestAnimationFrame(() => {
      offsetHeight.value = document.documentElement.offsetHeight;
      const scrollTop = document.documentElement.scrollTop;
      if (scrollTop < 100) {
        top.value = -900;
      } else {
        top.value = (900 - (scrollTop / offsetHeight.value) * 900) * -1; // [!code focus]
      }
      animationFrame = null;
    });
  }
};
```
